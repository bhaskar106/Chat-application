<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chat App</title>
    <script src="/socket.io/socket.io.js"></script>

    <style>
            input[type=text] {
            border: 2px solid rgb(185, 185, 185);
            border-radius: 10px;
            }
            button[type=submit]{
            cursor: pointer;
            border: 2px solid rgb(185, 185, 185);
            border-radius: 10px;
            background-color: #90EE90;
            position: center;
            bottom: 0;
            }
            input[type=submit]{
            cursor: pointer;
            border: 2px solid rgb(185, 185, 185);
            border-radius: 10px;
            }
            #send-container {
            position: fixed;
            overflow: auto;
            bottom: 0;
            background-color: white;
            display: flex;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
            } 

            #myHeader {
            color: black;
            text-align: center;
            }
            
            header {
            /*background-color:aqua;*/
            background-image: linear-gradient(cyan,white);
            padding: 30px;
            top:0;
            text-align: center;
            text-emphasis-color: black;
            font-size : 30px;
            color: white;
            }


            .rightside {
            height: 97%;
            width: 300px;
            position: fixed;
            top: 0;
            right: 0;
            /*background-color: #ffffff;*/
            background-image: linear-gradient(#ffc4c4,yellow,cyan);
            display: table-row;
            border: 2px solid rgb(134, 134, 134);
            border-radius: 10px;
            overflow-x: hidden;
            padding-top: 20px;
            text-align: center;
            resize: both;
            }

            .rightside a {
            padding: 6px 8px 6px 16px;
            text-decoration: none;
            font-size: 25px;
            color: #ffffff;
            display: block;
            }

            .rightside a:hover {
            background-color: hsl(180, 100%, 80%);
            }

            .leftside {
            height: 97%;
            width: 300px;
            position: fixed;
            top: 0;
            left: 0;
            /*background-color: #ffffff;*/
            background-image: linear-gradient(#ffc4c4,yellow,cyan);
            display: table-row-group;
            border: 2px solid rgb(134, 134, 134);
            border-radius: 10px;
            overflow-x: hidden;
            padding-top: 20px;
            text-align: center;
            resize: both;
            }

            .leftside a {
            padding: 6px 8px 6px 16px;
            text-decoration: none;
            font-size: 25px;
            color: #ffffff;
            display: block;
            }

            .leftside a:hover {
            background-color: hsl(180, 100%, 80%);
            }


            .Middle {
            height: 70%;
            width: 500px;
            position: fixed;
            background-color: #ffffff;
            border: 2px solid rgb(134, 134, 134);
            border-radius: 10px;
            padding-top: 20px;
            text-align: center;
            resize: both;
            left: 50%;
            bottom: 0;
            -ms-transform: translate(0%,0%);
                transform: translate(-50%, 0%);
            }

            .Middle a {
            padding: 6px 8px 6px 16px;
            text-decoration: none;
            font-size: 25px;
            color: #ffffff;
            display: block;
            }

            .Middle a:hover {
            background-color: hsl(180, 100%, 80%);
            }
            
            
    </style>
</head>

<body>
        <header>
          <h3 id="myHeader">Chat Application</h3>
        </header>


        <div class="rightside" id="message-container">
          <h2>Connections</h2>
        </div> 


        <div class="Middle" id="messages">
          <h2>Chat Messages</h2>
         <form id="send-container"> 
          <button type="button" onclick="myFunction()">update new users</button>
            <select id="mySelect" name="clients">
              <option>All</option> 
            </select>

          <input type="text" id="message-input">
          <button type="submit" id="send-button">Send</button>
         </form>
        </div>
        

        <div class="leftside" id="name-container" >
          <h2>List of users</h2>
        </div>
</body>

<script>
    console.log('hey its working')
    var socket = io('http://localhost:106')
    var messageContainer = document.getElementById('message-container')
    var messageForm = document.getElementById('send-container')
    var nameInput = document.getElementById('name-input')
    var messageInput = document.getElementById('message-input')
    var namecontainer = document.getElementById('name-container')
    var chatMessage = document.getElementById('messages')
    var users=[];
    //var x = document.getElementById("mySelect");
   // var options = document.createElement("option");
    var name = prompt("Enter your name:")
    if(name == null || name == ""){
        console.log('empty name is working')
        alert("Please enter a different user name");
    }
    else{
        console.log('name is working')
        appendMessage('You joined');
        socket.emit('new-user' , name )
      

      socket.on('username', name => {
        console.log('name receive from server working')
        printMessage(`${name}`)
      })

      socket.on('id', data => {
        console.log('id receive from server working')
        appendMessage(`Your Id :${data}`)
      })

      socket.on('clients', client=> {
        console.log('client names')
        console.log(`${client}`.length)
        printMessage(`${client}`)
        users = `${client}`.split(",")
      })

      
      socket.on('message', data => {
        console.log('message received from server')
        printChat(`${data.name}: ${data.message}`)
      })
      
      
      socket.on('chat-message', data => {
        console.log('message received from server')
        printChat(`${data.name}: ${data.message}`)
      })

      socket.on('Error', data => {
        console.log('Error')
        printChat('Sorry! the data given is not found in the server,Please check the user')
      })
      

      socket.on('user-connected', name => {
        console.log('user connected from server')
        appendMessage(`${name} connected`)
        //options.textContent = (`${name}`)
       // options.value = (`${name}`)
        //x.add(options, x[0])
      })

      socket.on('user-disconnected', data => {
        console.log('user disconnected from the server')
        appendMessage(`${data} disconnected`)
       //options.text = `${data}`
       //x.remove(options)
      })



      //just for checking
     socket.on('I',a => {
      console.log(a)
      appendMessage(`${a}`)
     })
 
     socket.on('S',b => {
      console.log(b)
      appendMessage(`${b}`)
     })

     socket.on('Obj',c => {
      console.log(c)
      appendMessage(JSON.stringify(c))
     })

     socket.on('ObjA',d => {
      console.log(d)
      appendMessage(JSON.stringify(d))
     })
 
     socket.on('ObjsA',e => {
      console.log(e)
      appendMessage(JSON.stringify(e))
     })

     socket.on('IA',f =>{
      console.log(f)
      appendMessage(JSON.stringify(f))
     })
 
     socket.on('SA',g => {
      console.log(g)
      appendMessage(JSON.stringify(g))
     })

     socket.on('OIA',h => {
      console.log(h)
      appendMessage(JSON.stringify(h))
     })

     socket.on('OOSIA',i => {
      console.log(i)
      appendMessage(JSON.stringify(i))
     })

     socket.on('AA',j => {
      console.log(j)
      appendMessage(JSON.stringify(j))
     })



      messageForm.addEventListener('submit', e => {
      e.preventDefault()
      const message = messageInput.value
      printChat(`To: ${mySelect.value} message: ${message}`)
      socket.emit('username',mySelect.value)
      socket.emit('send-chat-message', message )
      messageInput.value = ''
      mySelect.value = 'All'
      })
   
      function appendMessage(message) {
      const messageElement = document.createElement('div')
      messageElement.innerText = message
      messageContainer.append(messageElement)
      }

      function printMessage(content){
      const messagecontent = document.createElement('div')
      messagecontent.innerText = content
      namecontainer.append(messagecontent)
      }

      function printChat(content){
      const chatmessage = document.createElement('div')
      chatmessage.innerText = content
      chatMessage.append(chatmessage)
      }
    }

     function myFunction() {
      var x = document.getElementById("mySelect");
     // x.remove(options);
       for (i=0;i<users.length;i++) 
       {
         var a = users[i];
         var options = document.createElement("option");
         console.log("row" + i);
         console.log(" " + users[i]);
         console.log(options.textContent);
         console.log(users);
         options.textContent = a;
         options.value = a;
         x.appendChild(options);
       }
      }

</script>

</html>


